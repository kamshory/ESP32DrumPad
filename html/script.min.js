function _ce(e){return document.createElement(e)}function _nm(e){return document.getElementsByName(e)[0]}function _sl(e){return document.querySelector(e)}function _sls(e){return document.querySelectorAll(e)}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){let n=this;do{if(Element.prototype.matches.call(n,e))return n;n=n.parentElement||n.parentNode}while(null!==n&&1===n.nodeType);return null}),Element.prototype.remove||(Element.prototype.remove=function(e){this.parentNode.removeChild(this)}),Element.prototype.popupShow=function(){this.style.display="block",this.closest(".popup-shadow").style.display="block"},Element.prototype.popupHide=function(){this.style.display="none",this.closest(".popup-shadow").style.display="none"},Element.prototype.on=function(e,n,t){return this.addEventListener(e,n,t)},Element.prototype.off=function(e,n,t){return this.removeEventListener(e,n,t)},Element.prototype.find=function(e){return this.querySelector(e)},Element.prototype.findAll=function(e){return this.querySelectorAll(e)},Element.prototype.attr=function(e,n){return void 0!==n?this.setAttribute(e,n):this.getAttribute(e)};let ajax={},cMsg="Are you sure you want to save the configuration?",rMsg="Are you sure you want to reset the configuration?",pSel=".popup-confirm",pTtl="User Confirmation";function initPopUp(){_sls(".popup-closer").forEach(e=>{e.on("click",()=>{e.closest(".popup").popupHide()})})}function toast(e,n,t,o,s,a){n=n||"Info",t=t||"Info",o=o||"Hide";let i=_sl(e);i.find(".popup-header-text").innerText=t,i.find(".popup-body .message").innerText=n,i.find(".btn-ok")&&i.find(".btn-ok").remove(),i.find(".btn-cancel")&&i.find(".btn-cancel").remove();let l=_ce("button");l.attr("class","btn btn-success btn-ok"),l.innerText=o;i.find(".popup-footer").appendChild(l),i.popupShow(),s=s||function(){i.popupHide()};try{l.off("click")}catch(u){}let p=setTimeout(function(){s(),i.popupHide()},a);l.on("click",function(){s(),clearTimeout(p),i.popupHide()})}function customConfim(e,n,t,o,s,a,i){n=n||"Are you sure?",t=t||"Confirm",o=o||"OK",s=s||"Cancel";let l=_sl(e);l.find(".popup-header-text").innerText=t,l.find(".popup-body .message").innerText=n,l.find(".btn-ok")&&l.find(".btn-ok").remove(),l.find(".btn-cancel")&&l.find(".btn-cancel").remove();let u=_ce("button");u.attr("class","btn btn-success btn-ok"),u.innerText=o;let p=_ce("button");p.attr("class","btn btn-warning btn-cancel"),p.innerText=s;let r=l.find(".popup-footer");r.appendChild(u),r.appendChild(document.createTextNode(" ")),r.appendChild(p),l.popupShow(),a=a||function(){l.popupHide()},i=i||function(){l.popupHide()};try{u.off("click"),p.off("click")}catch(c){}u.on("click",function(){a(),l.popupHide()}),p.on("click",function(){i(),l.popupHide()})}function saveConfigWS(){return customConfim(pSel,cMsg,pTtl,"Yes","No",function(){ajax.post("save-ws.html",{action:"save-ws",wifi_enable:_nm("wifi_enable").value,ssid_name:_nm("ssid_name").value,ssid_password:_nm("ssid_password").value,ws_enable:_nm("ws_enable").value,ws_host:_nm("ws_host").value,ws_port:_nm("ws_port").value,ws_path:_nm("ws_path").value,ws_username:_nm("ws_username").value,ws_password:_nm("ws_password").value},function(e,n,t){console.log(t),toast(pSel,"Configuration saved","Success","Hide",null,1e3)},!0)},null),!1}function loadConfigWS(){ajax.get("ws-configuration.json",{},function(e,n,t){try{let o=JSON.parse(e);_nm("wifi_enable").value=o.wifi_enable,_nm("ssid_name").value=o.ssid_name,_nm("ssid_password").value=o.ssid_password,_nm("ws_enable").value=o.ws_enable,_nm("ws_scheme").value=o.ws_scheme,_nm("ws_host").value=o.ws_host,_nm("ws_port").value=o.ws_port,_nm("ws_path").value=o.ws_path,_nm("ws_username").value=o.ws_username,_nm("ws_password").value=o.ws_password}catch(s){}},!0)}function loadConfigAP(){ajax.get("ap-configuration.json",{},function(e,n,t){try{let o=JSON.parse(e);_nm("ssid_name").value=o.ssid_name,_nm("ssid_password").value=o.ssid_password,_nm("ip").value=o.ip,_nm("gateway").value=o.gateway,_nm("subnet").value=o.subnet,_nm("hidden").value=o.hidden}catch(s){}},!0)}function saveConfigAP(){return customConfim(pSel,cMsg,pTtl,"Yes","No",function(){ajax.post("save-ap.html",{action:"save-ap",ssid_name:_nm("ssid_name").value,ssid_password:_nm("ssid_password").value,ip:_nm("ip").value,gateway:_nm("gateway").value,subnet:_nm("subnet").value,hidden:_nm("hidden").value},function(e,n,t){toast(pSel,"Configuration saved","Success","Hide",null,1e3)},!0)},null),!1}function loadConfigGeneral(){ajax.get("general-configuration.json",{},function(e,n,t){try{let o=JSON.parse(e);_nm("channel").value=o.channel,_nm("read_interval").value=o.read_interval,_nm("solo_pad").value=o.solo_pad,_nm("solo_pad_number").value=o.solo_pad_number}catch(s){}},!0)}function loadDefaultGeneral(){customConfim(pSel,rMsg,pTtl,"Yes","No",function(){_nm("channel").value=10,_nm("read_interval").value=1e3,_nm("solo_pad").value=0,_nm("solo_pad_number").value=1},null)}function saveConfigGeneral(){return customConfim(pSel,cMsg,pTtl,"Yes","No",function(){ajax.post("save-general.html",{channel:_nm("channel").value,read_interval:_nm("read_interval").value,solo_pad:_nm("solo_pad").value,solo_pad_number:_nm("solo_pad_number").value},function(e,n,t){toast(pSel,"Configuration saved","Success","Hide",null,1e3)},!0)},null),!1}function handleIP(e){let n=e.target;isValidIP(n.value)?n.classList.remove("invalid-ip"):(n.classList.remove("invalid-ip"),n.classList.add("invalid-ip"))}function initIP(){let e=_sls('input[type="ipaddress"]');if(null!=e&&e.length)for(let n=0;n<e.length;n++)e[n].on("keyup",function(e){handleIP(e)}),e[n].on("change",function(e){handleIP(e)})}function isValidIP(e){if(0==e.length)return!0;let n,t=e.split(".");if(4!=t.length)return!1;for(n in t)if(isNaN(parseInt(t[n]))||t[n]<0||255<t[n])return!1;return!0}ajax.create=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(let e,n=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp",],t=0;t<n.length;t++)try{e=new ActiveXObject(n[t]);break}catch(o){}return httpRequest},ajax.send=function(e,n,t,o,s){void 0===s&&(s=!0);let a=ajax.create();a.open(t,e,s),a.onreadystatechange=function(){if(4==a.readyState&&null!=n&&"function"==typeof n){let e=n.length;1==e?n(a.responseText):2==e?n(a.responseText,a.status):3==e&&n(a.responseText,a.status,a.statusText)}},"POST"==t&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(o)},ajax.get=function(e,n,t,o){let s,a=[];if(void 0!==n)for(s in n)n.hasOwnProperty(s)&&a.push(encodeURIComponent(s)+"="+encodeURIComponent(n[s]));ajax.send(e+(a.length?"?"+a.join("&"):""),t,"GET",null,o)},ajax.post=function(e,n,t,o){let s,a=[];if(void 0!==n)for(s in n)n.hasOwnProperty(s)&&a.push(encodeURIComponent(s)+"="+encodeURIComponent(n[s]));ajax.send(e,t,"POST",a.join("&"),o)};